name: Build Windows Wheels

on:
  push:
    branches: ["master"]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    strategy:
      matrix:
        python-version:  ["3.11"]
        cibw-build: ["cp311"]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Boost headers
        run: |
          choco install boost-msvc-14.3 --yes
        # Headers go into C:\local\boost_*\

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install build dependencies
        run: |
          pip install cibuildwheel pybind11 cmake

      - name: Build wheel with cibuildwheel
        env:
          CIBW_PLATFORM: windows

          # Build only the specific CPython version
          CIBW_BUILD: ${{ matrix.cibw-build }}

          # Skip PyPy
          CIBW_SKIP: "pp*"

          # Environment inside the wheel build
          CIBW_ENVIRONMENT_WINDOWS: >
            BOOST_ROOT="C:\local\boost_1_86_0"
            BOOST_INCLUDEDIR="C:\local\boost_1_86_0"
            CMAKE_GENERATOR="Visual Studio 17 2022"
        run: |
          python -m cibuildwheel --output-dir wheelhouse

      - name: Upload wheels
        uses: actions/upload-artifact@v4
        with:
          name: bgl-wheels-${{ matrix.python-version }}
          path: wheelhouse/*.whl
